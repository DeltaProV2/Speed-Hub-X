--// Pet Spawner LocalScript

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- =========================
-- GUI CREATION
-- =========================

local gui = Instance.new("ScreenGui")
gui.Name = "PetSpawnerGui"
gui.ResetOnSpawn = false
gui.Parent = Player:WaitForChild("PlayerGui")

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 320)
frame.Position = UDim2.new(0.5, -175, 0.25, 0)
frame.Active = true
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.ClipsDescendants = false
frame.Parent = gui
Instance.new("UICorner", frame)

-- Top Bar
local top = Instance.new("Frame")
top.Size = UDim2.new(1, 0, 0, 40)
top.Position = UDim2.new(0, 0, 0, 0)
top.Active = true
top.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
top.BorderSizePixel = 0
top.ClipsDescendants = false
top.Parent = frame
Instance.new("UICorner", top)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -140, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Text = "Pet Spawner By Shxdrag"
title.Parent = top

-- Drag Bar
local DragBar = Instance.new("Frame")
DragBar.Size = UDim2.new(1, -140, 1, 0)
DragBar.Position = UDim2.new(0, 0, 0, 0)
DragBar.BackgroundTransparency = 1
DragBar.Parent = top

-- Buttons: Minimize / Expand / Move
local function createTopButton(text, pos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 30, 0, 30)
    btn.Position = pos
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    btn.TextScaled = true
    btn.Font = Enum.Font.GothamBold
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Parent = top
    Instance.new("UICorner", btn)
    return btn
end

local minimize = createTopButton("-", UDim2.new(1, -120, 0, 5))
local expand = createTopButton("+", UDim2.new(1, -120, 0, 5))
expand.Visible = false
local moveBtn = createTopButton("â†•", UDim2.new(1, -80, 0, 5))

-- Drag logic
local dragging, dragStart, startPos = false
local function updateDrag(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

moveBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateDrag(input)
    end
end)

-- Pet Name Input
local petNameBox = Instance.new("TextBox")
petNameBox.Size = UDim2.new(1, -20, 0, 40)
petNameBox.Position = UDim2.new(0, 10, 0, 60)
petNameBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
petNameBox.BorderSizePixel = 0
petNameBox.Font = Enum.Font.GothamBold
petNameBox.TextScaled = true
petNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
petNameBox.PlaceholderText = "Put Pet Name!"
petNameBox.ClearTextOnFocus = false
petNameBox.Parent = frame
Instance.new("UICorner", petNameBox)

-- Pet Type Dropdown
local typeLabel = Instance.new("TextLabel")
typeLabel.Size = UDim2.new(1, -20, 0, 25)
typeLabel.Position = UDim2.new(0, 10, 0, 110)
typeLabel.BackgroundTransparency = 1
typeLabel.Text = "Pet Type: FR"
typeLabel.TextColor3 = Color3.fromRGB(255,255,255)
typeLabel.Font = Enum.Font.GothamBold
typeLabel.TextScaled = true
typeLabel.Parent = frame

local typeDropdown = Instance.new("TextButton")
typeDropdown.Size = UDim2.new(1, -20, 0, 40)
typeDropdown.Position = UDim2.new(0, 10, 0, 140)
typeDropdown.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
typeDropdown.Text = "Select Type (FR/NFR/MFR)"
typeDropdown.TextColor3 = Color3.fromRGB(255,255,255)
typeDropdown.Font = Enum.Font.GothamBold
typeDropdown.TextScaled = true
typeDropdown.Parent = frame
Instance.new("UICorner", typeDropdown)

local petType = "FR"
typeDropdown.MouseButton1Click:Connect(function()
    if petType == "FR" then
        petType = "NFR"
    elseif petType == "NFR" then
        petType = "MFR"
    else
        petType = "FR"
    end
    typeDropdown.Text = "Type: "..petType
    typeLabel.Text = "Pet Type: "..petType
end)

-- Spawn Button
local spawnBtn = Instance.new("TextButton")
spawnBtn.Size = UDim2.new(1, -20, 0, 45)
spawnBtn.Position = UDim2.new(0, 10, 0, 200)
spawnBtn.BackgroundColor3 = Color3.fromRGB(70, 120, 255)
spawnBtn.BorderSizePixel = 0
spawnBtn.Font = Enum.Font.GothamBold
spawnBtn.TextScaled = true
spawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
spawnBtn.Text = "Spawn Pet"
spawnBtn.Parent = frame
Instance.new("UICorner", spawnBtn)

-- =========================
-- PET LOGIC
-- =========================

task.spawn(function()
    local load = require(ReplicatedStorage:WaitForChild("Fsys")).load

    set_thread_identity(2)
    local clientData = load("ClientData")
    local items = load("KindDB")
    local router = load("RouterClient")
    local downloader = load("DownloadClient")
    local animationManager = load("AnimationManager")
    local petRigs = load("new:PetRigs")
    set_thread_identity(8)

    local petModels = {}
    local pets = {}
    local equippedPet = nil
    local mountedPet = nil
    local currentMountTrack = nil

    local function updateData(key, action)
        local data = clientData.get(key)
        local clonedData = table.clone(data)
        clientData.predict(key, action(clonedData))
    end

    local function getUniqueId()
        local HttpService = game:GetService("HttpService")
        return HttpService:GenerateGUID(false)
    end

    local function getPetModel(kind)
        if petModels[kind] then return petModels[kind] end
        local streamed = downloader.promise_download_copy("Pets", kind):expect()
        petModels[kind] = streamed
        return streamed
    end

    local function createPet(id, properties)
        local uniqueId = getUniqueId()
        local pet = nil

        set_thread_identity(2)
        updateData(
            "inventory",
            function(inventory)
                local newPets = table.clone(inventory.pets)
                local item = items[id]
                pet = {
                    unique = uniqueId,
                    category = "pets",
                    id = id,
                    kind = item.kind,
                    newness_order = 0,
                    properties = properties
                }
                newPets[uniqueId] = pet
                inventory.pets = newPets
                return inventory
            end
        )

        set_thread_identity(8)
        pets[uniqueId] = {data = pet, model = nil}
        return pet
    end

    local InventoryDB = load("InventoryDB")
    local function GetPetByName(name)
        for i, v in pairs(InventoryDB.pets) do
            if v.name:lower() == name:lower() then return v.id end
        end
        return false
    end

    spawnBtn.MouseButton1Click:Connect(function()
        local petName = petNameBox.Text
        if not petName or petName == "" then
            warn("Enter a pet name!")
            return
        end
        local petId = GetPetByName(petName)
        if not petId then
            warn("Pet not found!")
            return
        end
        local props = {rideable=true, flyable=true, pet_trick_level=0, friendship_level=0, age=1, ailments_completed=0, rp_name=""}
        if petType == "NFR" then props.neon = true end
        if petType == "MFR" then props.mega_neon = true end
        createPet(petId, props)
        warn("Pet spawned: "..petName.." Type: "..petType)
    end)
end)
