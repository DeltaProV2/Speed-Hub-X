-- Full Pet Spawner UI with top-bar-only draggable (PC + Mobile)
local player = game.Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local gui = Instance.new("ScreenGui")
gui.Name = "PetSpawnerUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 270)
frame.Position = UDim2.new(0.5, -175, 0.25, 0)
frame.Active = true -- REQUIRED FOR DRAGGING
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Parent = gui
Instance.new("UICorner", frame)

-- Top Bar
local top = Instance.new("Frame")
top.Size = UDim2.new(1, 0, 0, 40)
top.Position = UDim2.new(0, 0, 0, 0)
top.Active = true -- REQUIRED FOR DRAGGING
top.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
top.BorderSizePixel = 0
top.Parent = frame
Instance.new("UICorner", top)


local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -100, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Text = "Pet Spawner By Shxdrag"
title.Parent = top

-- Minimize Button
local minimize = Instance.new("TextButton")
minimize.Size = UDim2.new(0, 30, 0, 30)
minimize.Position = UDim2.new(1, -70, 0, 5)
minimize.Text = "-"
minimize.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minimize.TextScaled = true
minimize.Font = Enum.Font.GothamBold
minimize.TextColor3 = Color3.new(1,1,1)
minimize.Parent = top
Instance.new("UICorner", minimize)

-- Move Button (↕)
local moveBtn = Instance.new("TextButton")
moveBtn.Size = UDim2.new(0, 30, 0, 30)
moveBtn.Position = UDim2.new(1, -100, 0, 5)
moveBtn.Text = "↕"
moveBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
moveBtn.TextScaled = true
moveBtn.Font = Enum.Font.GothamBold
moveBtn.TextColor3 = Color3.new(1,1,1)
moveBtn.Parent = top
Instance.new("UICorner", moveBtn)

-- Expand Button
local expand = Instance.new("TextButton")
expand.Size = UDim2.new(0, 30, 0, 30)
expand.Position = UDim2.new(1, -70, 0, 5)
expand.Text = "+"
expand.Visible = false
expand.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
expand.TextScaled = true
expand.Font = Enum.Font.GothamBold
expand.TextColor3 = Color3.new(1,1,1)
expand.Parent = top
Instance.new("UICorner", expand)

-- PET NAME BOX
local petName = Instance.new("TextBox")
petName.Size = UDim2.new(1, -20, 0, 40)
petName.Position = UDim2.new(0, 10, 0, 60)
petName.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
petName.BorderSizePixel = 0
petName.Font = Enum.Font.GothamBold
petName.TextScaled = true
petName.TextColor3 = Color3.fromRGB(255, 255, 255)
petName.PlaceholderText = "Put Pet Name!"
petName.ClearTextOnFocus = false
petName.Parent = frame
Instance.new("UICorner", petName)

-- Rarity Buttons Holder
local rarityFrame = Instance.new("Frame")
rarityFrame.Size = UDim2.new(1, 0, 0, 60)
rarityFrame.Position = UDim2.new(0, 0, 0, 110)
rarityFrame.BackgroundTransparency = 1
rarityFrame.Parent = frame

local uiList = Instance.new("UIListLayout")
uiList.FillDirection = Enum.FillDirection.Horizontal
uiList.HorizontalAlignment = Enum.HorizontalAlignment.Center
uiList.Padding = UDim.new(0, 10)
uiList.Parent = rarityFrame

local selectedRarity = nil

local selectedLabel = Instance.new("TextLabel")
selectedLabel.Size = UDim2.new(1, -20, 0, 30)
selectedLabel.Position = UDim2.new(0, 10, 0, 225)
selectedLabel.BackgroundTransparency = 1
selectedLabel.Font = Enum.Font.GothamSemibold
selectedLabel.TextScaled = true
selectedLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
selectedLabel.Text = "Selected: None"
selectedLabel.Parent = frame

local function createRarityButton(name, color)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 90, 1, -5)
    button.BackgroundColor3 = color
    button.BorderSizePixel = 0
    button.TextColor3 = Color3.fromRGB(255,255,255)
    button.Font = Enum.Font.GothamBold
    button.TextScaled = true
    button.Text = name
    button.Parent = rarityFrame
    Instance.new("UICorner", button)

    button.MouseButton1Click:Connect(function()
        selectedRarity = name
        selectedLabel.Text = "Selected: " .. name
    end)
end

createRarityButton("MFR", Color3.fromRGB(255, 100, 100))
createRarityButton("NFR", Color3.fromRGB(100, 255, 100))
createRarityButton("FR", Color3.fromRGB(100, 100, 255))

-- Spawn Button
local spawnBtn = Instance.new("TextButton")
spawnBtn.Size = UDim2.new(1, -20, 0, 45)
spawnBtn.Position = UDim2.new(0, 10, 0, 175)
spawnBtn.BackgroundColor3 = Color3.fromRGB(70, 120, 255)
spawnBtn.BorderSizePixel = 0
spawnBtn.Font = Enum.Font.GothamBold
spawnBtn.TextScaled = true
spawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
spawnBtn.Text = "Spawn Pet"
spawnBtn.Parent = frame
Instance.new("UICorner", spawnBtn)

spawnBtn.MouseButton1Click:Connect(function()
    local name = petName.Text ~= "" and petName.Text or "Unknown Pet"
    local rarity = selectedRarity or "None"
    selectedLabel.Text = "Pet Spawned: " .. name .. " (" .. rarity .. ")"
end)

-------------------------------------------------------------
-- Minimize system (robust)
-------------------------------------------------------------
local savedVisibility = {}

local function hideAllContent()
    savedVisibility = {}
    for _, obj in ipairs(frame:GetDescendants()) do
        if obj:IsA("GuiObject") and obj ~= top and not obj:IsDescendantOf(top) then
            savedVisibility[obj] = obj.Visible
            obj.Visible = false
        end
    end
end

local function restoreAllContent()
    for obj, state in pairs(savedVisibility) do
        if obj and obj.Parent then
            obj.Visible = state
        end
    end
    savedVisibility = {}
end

local fullSize = UDim2.new(0, 350, 0, 270)
local minimizedSize = UDim2.new(0, 350, 0, 40)

minimize.MouseButton1Click:Connect(function()
    TweenService:Create(frame, TweenInfo.new(0.3), {Size = minimizedSize}):Play()
    minimize.Visible = false
    expand.Visible = true
    hideAllContent()
end)

expand.MouseButton1Click:Connect(function()
    TweenService:Create(frame, TweenInfo.new(0.3), {Size = fullSize}):Play()
    minimize.Visible = true
    expand.Visible = false
    restoreAllContent()
end)

-------------------------------------------------------------
-- Top-bar DRAGGING (PC + Mobile) with screen bounds
-- Only when dragging the top bar (so buttons stay clickable)
-------------------------------------------------------------
local dragging = false
local dragInput = nil
local dragStart = Vector2.new()
local startPos = UDim2.new()

-- Helper to get viewport size (works in LocalScript)
local function getViewport()
    local cam = workspace.CurrentCamera
    if cam then
        return cam.ViewportSize
    else
        return Vector2.new(800, 600)
    end
end

local function clampPosition(xOffset, yOffset)
    local viewport = getViewport()
    local absSize = frame.AbsoluteSize

    local minX = 0
    local minY = 0
    local maxX = math.max(0, viewport.X - absSize.X)
    local maxY = math.max(0, viewport.Y - absSize.Y)

    local clampedX = math.clamp(xOffset, minX, maxX)
    local clampedY = math.clamp(yOffset, minY, maxY)
    return clampedX, clampedY
end

local function update(input)
    if not dragging then return end
    local delta = input.Position - dragStart
    local newX = startPos.X.Offset + delta.X
    local newY = startPos.Y.Offset + delta.Y

    local clampedX, clampedY = clampPosition(newX, newY)
    frame.Position = UDim2.new(startPos.X.Scale, clampedX, startPos.Y.Scale, clampedY)
end

top.InputBegan:Connect(function(input)
    -- begin drag only on left mouse button or touch
    if input.UserInputType == Enum.UserInputType.MouseButton1 or
       input.UserInputType == Enum.UserInputType.Touch then

        -- don't start dragging if the user clicked the minimize/expand buttons
        if input.Target and (input.Target == minimize or input.Target == expand) then
            return
        end

        dragging = true
        dragInput = input
        dragStart = input.Position
        startPos = frame.Position

        -- stop dragging when the input ends
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

-- DRAG USING MOVE BUTTON ONLY
local dragging = false
local dragStart
local startPos

local userInput = game:GetService("UserInputService")
local runService = game:GetService("RunService")

local function update(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

moveBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
    or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
    end
end)

moveBtn.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
    or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

runService.RenderStepped:Connect(function()
    if dragging then
        local input = userInput:GetMouseLocation()
        update({Position = input})
    end
end)


-- For mouse movement and touch movement
UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        update(input)
    end
end)

-- Ensure frame.AbsoluteSize is valid before dragging (in case UI hasn't fully rendered)
frame:GetPropertyChangedSignal("AbsoluteSize"):Connect(function() end)

-- Also stop dragging if the gui is hidden/minimized
minimize.Changed:Connect(function()
    if not minimize.Visible then
        dragging = false
    end
end)
expand.Changed:Connect(function()
    if not expand.Visible then
        -- nothing
    end
end)

-- Optional: keep it from going under the top bar (snap if needed) - not required
-------------------------------------------------------------

-- End of script
