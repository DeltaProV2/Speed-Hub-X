--// CLEAN PET SPAWN FUNCTIONS (EXTRACTED)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")

local load = require(ReplicatedStorage:WaitForChild("Fsys")).load

local clientData     = load("ClientData")
local items          = load("KindDB")
local downloader     = load("DownloadClient")
local InventoryDB    = load("InventoryDB")

local petModels = {}
local pets = {}

-- Generate unique ID
local function getUniqueId()
    return HttpService:GenerateGUID(false)
end

-- Download + cache pet model
local function getPetModel(kind)
    if petModels[kind] then
        return petModels[kind]
    end
    local streamed = downloader.promise_download_copy("Pets", kind):expect()
    petModels[kind] = streamed
    return streamed
end

-- Update inventory state
local function updateInventory(action)
    local data = clientData.get("inventory")
    local cloned = table.clone(data)
    clientData.predict("inventory", action(cloned))
end

-- Create pet in player inventory
function CreatePet(id, properties)
    local uid = getUniqueId()
    local newPet = nil

    updateInventory(function(inv)
        local newPets = table.clone(inv.pets)
        local item = items[id]

        newPet = {
            unique = uid,
            category = "pets",
            id = id,
            kind = item.kind,
            newness_order = 0,
            properties = properties
        }

        newPets[uid] = newPet
        inv.pets = newPets
        return inv
    end)

    pets[uid] = {data = newPet, model = nil}
    return newPet
end

-- Find pet ID by name
function GetPetByName(name)
    for _, v in pairs(InventoryDB.pets) do
        if v.name:lower() == name:lower() then
            return v.id
        end
    end
    return false
end

-- MAIN SPAWN FUNCTION YOU WILL CALL
function SpawnPet(petName, petType)
    local petId = GetPetByName(petName)
    if not petId then
        warn("Pet not found:", petName)
        return
    end

    if petType == "FR" then
        CreatePet(petId, {
            rideable = true,
            flyable = true,
            pet_trick_level = 0,
            friendship_level = 0,
            age = 1,
            rp_name = ""
        })

    elseif petType == "NFR" then
        CreatePet(petId, {
            neon = true,
            rideable = true,
            flyable = true,
            pet_trick_level = 0,
            friendship_level = 0,
            age = 1,
            rp_name = ""
        })

    elseif petType == "MFR" then
        CreatePet(petId, {
            mega_neon = true,
            rideable = true,
            flyable = true,
            pet_trick_level = 0,
            friendship_level = 0,
            age = 1,
            rp_name = ""
        })
    end

    print("Spawned:", petName, petType)
end
