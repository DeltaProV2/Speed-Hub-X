-- Full Pet Spawner UI with Move button dragging + Pet Spawn Exploit
local player = game.Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

-- Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "PetSpawnerUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 350, 0, 270)
frame.Position = UDim2.new(0.5, -175, 0.25, 0)
frame.Active = true
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.ClipsDescendants = false
frame.Parent = gui
Instance.new("UICorner", frame)

-- Top Bar
local top = Instance.new("Frame")
top.Size = UDim2.new(1, 0, 0, 40)
top.Position = UDim2.new(0, 0, 0, 0)
top.Active = true
top.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
top.BorderSizePixel = 0
top.ClipsDescendants = false
top.Parent = frame
Instance.new("UICorner", top)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -140, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Text = "Pet Spawner By Shxdrag"
title.Parent = top

-- Drag Bar (left part only)
local DragBar = Instance.new("Frame")
DragBar.Name = "DragBar"
DragBar.Size = UDim2.new(1, -140, 1, 0)
DragBar.Position = UDim2.new(0, 0, 0, 0)
DragBar.BackgroundTransparency = 1
DragBar.Parent = top

-- Minimize / Expand buttons
local minimize = Instance.new("TextButton")
minimize.Size = UDim2.new(0, 30, 0, 30)
minimize.Position = UDim2.new(1, -120, 0, 5)
minimize.Text = "-"
minimize.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
minimize.TextScaled = true
minimize.Font = Enum.Font.GothamBold
minimize.TextColor3 = Color3.new(1,1,1)
minimize.Parent = top
Instance.new("UICorner", minimize)

local expand = Instance.new("TextButton")
expand.Size = UDim2.new(0, 30, 0, 30)
expand.Position = UDim2.new(1, -120, 0, 5)
expand.Text = "+"
expand.Visible = false
expand.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
expand.TextScaled = true
expand.Font = Enum.Font.GothamBold
expand.TextColor3 = Color3.new(1,1,1)
expand.Parent = top
Instance.new("UICorner", expand)

-- Move button
local moveBtn = Instance.new("TextButton")
moveBtn.Size = UDim2.new(0, 30, 0, 30)
moveBtn.Position = UDim2.new(1, -80, 0, 5)
moveBtn.Text = "â†•"
moveBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
moveBtn.TextScaled = true
moveBtn.Font = Enum.Font.GothamBold
moveBtn.TextColor3 = Color3.new(1,1,1)
moveBtn.Parent = top
Instance.new("UICorner", moveBtn)

-- Drag logic (PC + Mobile)
local dragging = false
local dragStart
local startPos

local function updateDrag(input)
    local delta = input.Position - dragStart
    frame.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

moveBtn.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging then
        if input.UserInputType == Enum.UserInputType.MouseMovement
            or input.UserInputType == Enum.UserInputType.Touch then
            updateDrag(input)
        end
    end
end)

-- Pet Name Box
local petNameBox = Instance.new("TextBox")
petNameBox.Size = UDim2.new(1, -20, 0, 40)
petNameBox.Position = UDim2.new(0, 10, 0, 60)
petNameBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
petNameBox.BorderSizePixel = 0
petNameBox.Font = Enum.Font.GothamBold
petNameBox.TextScaled = true
petNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
petNameBox.PlaceholderText = "Put Pet Name!"
petNameBox.ClearTextOnFocus = false
petNameBox.Parent = frame
Instance.new("UICorner", petNameBox)

-- Rarity Buttons
local rarityFrame = Instance.new("Frame")
rarityFrame.Size = UDim2.new(1, 0, 0, 60)
rarityFrame.Position = UDim2.new(0, 0, 0, 110)
rarityFrame.BackgroundTransparency = 1
rarityFrame.Parent = frame

local uiList = Instance.new("UIListLayout")
uiList.FillDirection = Enum.FillDirection.Horizontal
uiList.HorizontalAlignment = Enum.HorizontalAlignment.Center
uiList.Padding = UDim.new(0, 10)
uiList.Parent = rarityFrame

local selectedRarity = nil
local selectedLabel = Instance.new("TextLabel")
selectedLabel.Size = UDim2.new(1, -20, 0, 30)
selectedLabel.Position = UDim2.new(0, 10, 0, 225)
selectedLabel.BackgroundTransparency = 1
selectedLabel.Font = Enum.Font.GothamSemibold
selectedLabel.TextScaled = true
selectedLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
selectedLabel.Text = "Selected: None"
selectedLabel.Parent = frame

local function createRarityButton(name, color)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 90, 1, -5)
    button.BackgroundColor3 = color
    button.BorderSizePixel = 0
    button.TextColor3 = Color3.fromRGB(255,255,255)
    button.Font = Enum.Font.GothamBold
    button.TextScaled = true
    button.Text = name
    button.Parent = rarityFrame
    Instance.new("UICorner", button)

    button.MouseButton1Click:Connect(function()
        selectedRarity = name
        selectedLabel.Text = "Selected: " .. name
    end)
end

createRarityButton("MFR", Color3.fromRGB(255, 100, 100))
createRarityButton("NFR", Color3.fromRGB(100, 255, 100))
createRarityButton("FR", Color3.fromRGB(100, 100, 255))

-- Spawn Button
local spawnBtn = Instance.new("TextButton")
spawnBtn.Size = UDim2.new(1, -20, 0, 45)
spawnBtn.Position = UDim2.new(0, 10, 0, 175)
spawnBtn.BackgroundColor3 = Color3.fromRGB(70, 120, 255)
spawnBtn.BorderSizePixel = 0
spawnBtn.Font = Enum.Font.GothamBold
spawnBtn.TextScaled = true
spawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
spawnBtn.Text = "Spawn Pet"
spawnBtn.Parent = frame
Instance.new("UICorner", spawnBtn)

-- Minimize / Expand logic
local savedVisibility = {}
local fullSize = UDim2.new(0, 350, 0, 270)
local minimizedSize = UDim2.new(0, 350, 0, 40)

local function hideAllContent()
    savedVisibility = {}
    for _, obj in ipairs(frame:GetDescendants()) do
        if obj:IsA("GuiObject") and obj ~= top and not obj:IsDescendantOf(top) then
            savedVisibility[obj] = obj.Visible
            obj.Visible = false
        end
    end
end

local function restoreAllContent()
    for obj, state in pairs(savedVisibility) do
        if obj and obj.Parent then
            obj.Visible = state
        end
    end
    savedVisibility = {}
end

minimize.MouseButton1Click:Connect(function()
    TweenService:Create(frame, TweenInfo.new(0.3), {Size = minimizedSize}):Play()
    minimize.Visible = false
    expand.Visible = true
    hideAllContent()
end)

expand.MouseButton1Click:Connect(function()
    TweenService:Create(frame, TweenInfo.new(0.3), {Size = fullSize}):Play()
    minimize.Visible = true
    expand.Visible = false
    restoreAllContent()
end)

-------------------------------------------------------------
-- PET SPAWNING & EQUIP LOGIC
-------------------------------------------------------------
task.spawn(function()
    local load = require(game.ReplicatedStorage:WaitForChild("Fsys")).load
    set_thread_identity(2)
    local clientData = load("ClientData")
    local items = load("KindDB")
    local downloader = load("DownloadClient")
    local animationManager = load("AnimationManager")
    local petRigs = load("new:PetRigs")
    set_thread_identity(8)

    local petModels, pets, equippedPet = {}, {}, nil

    local function updateData(key, action)
        local data = clientData.get(key)
        local clonedData = table.clone(data)
        clientData.predict(key, action(clonedData))
    end

    local HttpService = game:GetService("HttpService")
    local function getUniqueId() return HttpService:GenerateGUID(false) end

    local function getPetModel(kind)
        if petModels[kind] then return petModels[kind] end
        local streamed = downloader.promise_download_copy("Pets", kind):expect()
        petModels[kind] = streamed
        return streamed
    end

    local function createPet(id, properties)
        local uniqueId = getUniqueId()
        local pet = nil

        set_thread_identity(2)
        updateData("inventory", function(inventory)
            local newPets = table.clone(inventory.pets)
            local item = items[id]
            pet = {
                unique = uniqueId,
                category = "pets",
                id = id,
                kind = item.kind,
                newness_order = 0,
                properties = properties
            }
            newPets[uniqueId] = pet
            inventory.pets = newPets
            return inventory
        end)
        set_thread_identity(8)
        pets[uniqueId] = {data = pet, model = nil}
        return pet
    end

    local Loads = require(game.ReplicatedStorage.Fsys).load
    local InventoryDB = Loads("InventoryDB")
    local function GetPetByName(name)
        for i,v in pairs(InventoryDB.pets) do
            if v.name:lower() == name:lower() then return v.id end
        end
        return false
    end

    local function equipPet(pet)
        local petModel = getPetModel(items[pet.id].kind):Clone()
        petModel.Parent = workspace
        pets[pet.unique].model = petModel

        -- Add wrapper
        updateData("pet_char_wrappers", function(wrappers)
            local newWrapper = table.clone(wrappers)
            table.insert(newWrapper, {
                char = petModel,
                mega_neon = pet.properties.mega_neon,
                neon = pet.properties.neon,
                player = player,
                entity_controller = player,
                controller = player,
                rp_name = pet.properties.rp_name or "",
                pet_trick_level = pet.properties.pet_trick_level,
                pet_unique = pet.unique,
                pet_id = pet.id,
                location = {
                    full_destination_id = "housing",
                    destination_id = "housing",
                    house_owner = player
                },
                pet_progression = {
                    friendship_level = pet.properties.friendship_level,
                    age = pet.properties.age,
                    percentage = 0
                },
                are_colors_sealed = false,
                is_pet = true
            })
            return newWrapper
        end)

        -- Add state
        updateData("pet_state_managers", function(states)
            local newStates = table.clone(states)
            table.insert(newStates, {
                char = petModel,
                player = player,
                store_key = "pet_state_managers",
                is_sitting = false,
                chars_connected_to_me = {},
                states = {}
            })
            return newStates
        end)

        equippedPet = pet
    end

    spawnBtn.MouseButton1Click:Connect(function()
        local name = petNameBox.Text ~= "" and petNameBox.Text or "Unknown Pet"
        local rarity = selectedRarity or "FR"
        local petId = GetPetByName(name)
        if not petId then
            warn("Pet not found!")
            return
        end

        local properties = {pet_trick_level=0, rideable=true, flyable=true, friendship_level=0, age=1, ailments_completed=0, rp_name=""}
        if rarity == "NFR" then properties.neon = true end
        if rarity == "MFR" then properties.mega_neon = true end

        local pet = createPet(petId, properties)
        equipPet(pet)

        selectedLabel.Text = "Pet Spawned: "..name.." ("..rarity..")"
    end)
end)
