task.spawn(function()
    local player = game.Players.LocalPlayer
    local TweenService = game:GetService("TweenService")
    local UserInputService = game:GetService("UserInputService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")

    -- =========================
    -- GUI CREATION (your GUI)
    -- =========================

    local gui = Instance.new("ScreenGui")
    gui.Name = "PetSpawnerUI"
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    gui.Parent = player:WaitForChild("PlayerGui")

    -- Main Frame
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 350, 0, 270)
    frame.Position = UDim2.new(0.5, -175, 0.25, 0)
    frame.Active = true
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 0
    frame.ClipsDescendants = false
    frame.Parent = gui
    Instance.new("UICorner", frame)

    -- Top Bar
    local top = Instance.new("Frame")
    top.Size = UDim2.new(1, 0, 0, 40)
    top.Position = UDim2.new(0, 0, 0, 0)
    top.Active = true
    top.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    top.BorderSizePixel = 0
    top.ClipsDescendants = false
    top.Parent = frame
    Instance.new("UICorner", top)

    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -140, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextScaled = true
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Text = "Pet Spawner By Shxdrag"
    title.Parent = top

    -- Drag Bar
    local DragBar = Instance.new("Frame")
    DragBar.Size = UDim2.new(1, -140, 1, 0)
    DragBar.Position = UDim2.new(0, 0, 0, 0)
    DragBar.BackgroundTransparency = 1
    DragBar.Parent = top

    -- Buttons: Minimize / Expand / Move
    local function createTopButton(text, pos)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0, 30, 0, 30)
        btn.Position = pos
        btn.Text = text
        btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
        btn.TextScaled = true
        btn.Font = Enum.Font.GothamBold
        btn.TextColor3 = Color3.new(1,1,1)
        btn.Parent = top
        Instance.new("UICorner", btn)
        return btn
    end

    local minimize = createTopButton("-", UDim2.new(1, -120, 0, 5))
    local expand = createTopButton("+", UDim2.new(1, -120, 0, 5))
    expand.Visible = false
    local moveBtn = createTopButton("â†•", UDim2.new(1, -80, 0, 5))

    -- Drag logic (PC + Mobile)
    local dragging, dragStart, startPos = false
    local function updateDrag(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end

    moveBtn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            updateDrag(input)
        end
    end)

    -- Pet name input
    local petNameBox = Instance.new("TextBox")
    petNameBox.Size = UDim2.new(1, -20, 0, 40)
    petNameBox.Position = UDim2.new(0, 10, 0, 60)
    petNameBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    petNameBox.BorderSizePixel = 0
    petNameBox.Font = Enum.Font.GothamBold
    petNameBox.TextScaled = true
    petNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    petNameBox.PlaceholderText = "Put Pet Name!"
    petNameBox.ClearTextOnFocus = false
    petNameBox.Parent = frame
    Instance.new("UICorner", petNameBox)

    -- Spawn button
    local spawnBtn = Instance.new("TextButton")
    spawnBtn.Size = UDim2.new(1, -20, 0, 45)
    spawnBtn.Position = UDim2.new(0, 10, 0, 175)
    spawnBtn.BackgroundColor3 = Color3.fromRGB(70, 120, 255)
    spawnBtn.BorderSizePixel = 0
    spawnBtn.Font = Enum.Font.GothamBold
    spawnBtn.TextScaled = true
    spawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
    spawnBtn.Text = "Spawn Pet"
    spawnBtn.Parent = frame
    Instance.new("UICorner", spawnBtn)

    -- =========================
    -- Exploit-style Pet Spawn logic
    -- =========================

    local load = require(ReplicatedStorage:WaitForChild("Fsys")).load
    set_thread_identity(2)
    local clientData = load("ClientData")
    local items = load("KindDB")
    local downloader = load("DownloadClient")
    local petRigs = load("new:PetRigs")
    set_thread_identity(8)

    local petModels = {}
    local pets = {}

    local function getUniqueId()
        local HttpService = game:GetService("HttpService")
        return HttpService:GenerateGUID(false)
    end

    local function getPetModel(kind)
        if petModels[kind] then
            return petModels[kind]
        end
        local streamed = downloader.promise_download_copy("Pets", kind):expect()
        petModels[kind] = streamed
        return streamed
    end

    local function createPet(id, properties)
        local uniqueId = getUniqueId()
        local pet = nil

        set_thread_identity(2)
        local data = clientData.get("inventory")
        local cloned = table.clone(data)
        pet = {
            unique = uniqueId,
            category = "pets",
            id = id,
            kind = items[id].kind,
            properties = properties
        }
        cloned.pets[uniqueId] = pet
        clientData.predict("inventory", cloned)
        set_thread_identity(8)

        pets[uniqueId] = {data = pet, model = nil}
        return pet
    end

    local InventoryDB = load("InventoryDB")
    local function GetPetByName(name)
        for i, v in pairs(InventoryDB.pets) do
            if v.name:lower() == name:lower() then
                return v.id
            end
        end
        return false
    end

    spawnBtn.MouseButton1Click:Connect(function()
        local petName = petNameBox.Text
        if not petName or petName == "" then
            warn("Enter a pet name!")
            return
        end
        local petId = GetPetByName(petName)
        if not petId then
            warn("Pet not found!")
            return
        end
        createPet(petId, {rideable=true, flyable=true})
        warn("Pet spawned: "..petName)
    end)
end)
