--// Services
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

print("DEBUG: LocalScript Loaded")

--// Temporary local inventory
local LocalInventory = {}

--// Folder to store pets in workspace
local PetFolder = Workspace:FindFirstChild("LocalPets") or Instance.new("Folder")
PetFolder.Name = "LocalPets"
PetFolder.Parent = Workspace

print("DEBUG: PetFolder located at:", PetFolder:GetFullName())

--// GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PetSpawnerGui"
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

print("DEBUG: GUI Initialized")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 180)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(255, 150, 200)
MainFrame.BorderSizePixel = 0
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Parent = ScreenGui

-- Gradient
local UIGradient = Instance.new("UIGradient")
UIGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 180, 220)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 140, 210))
})
UIGradient.Rotation = 90
UIGradient.Parent = MainFrame

-- Neon border
local Stroke = Instance.new("UIStroke")
Stroke.Thickness = 3
Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
Stroke.Color = Color3.fromRGB(255, 0, 200)
Stroke.Parent = MainFrame

local neonColors = {
	Color3.fromRGB(255, 0, 200),
	Color3.fromRGB(0, 220, 255),
	Color3.fromRGB(180, 0, 255),
	Color3.fromRGB(255, 120, 0),
}

task.spawn(function()
	while true do
		for _, neonColor in ipairs(neonColors) do
			local tween = TweenService:Create(Stroke, TweenInfo.new(1.5, Enum.EasingStyle.Linear), {Color = neonColor})
			tween:Play()
			tween.Completed:Wait()
		end
	end
end)

-- UICorner
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 10)

-- Title Frame
local TitleFrame = Instance.new("Frame")
TitleFrame.Size = UDim2.new(1, -20, 0, 35)
TitleFrame.Position = UDim2.new(0, 10, 0, 5)
TitleFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
TitleFrame.BackgroundTransparency = 0.1
TitleFrame.BorderSizePixel = 0
TitleFrame.Parent = MainFrame
Instance.new("UICorner", TitleFrame).CornerRadius = UDim.new(0,8)

-- Title Text
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1,0,1,0)
Title.BackgroundTransparency = 1
Title.Text = "amina pets nyo"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = TitleFrame

-- PetNameBox
local PetNameBox = Instance.new("TextBox")
PetNameBox.Size = UDim2.new(0.9,0,0,30)
PetNameBox.Position = UDim2.new(0.05,0,0,50)
PetNameBox.PlaceholderText = "Enter Pet Name"
PetNameBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
PetNameBox.TextColor3 = Color3.fromRGB(255,255,255)
PetNameBox.Font = Enum.Font.SourceSans
PetNameBox.TextSize = 18
PetNameBox.ClearTextOnFocus = false
PetNameBox.Parent = MainFrame
Instance.new("UICorner", PetNameBox).CornerRadius = UDim.new(0,5)

-- Button helper
local function CreateButton(name,color,posX)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.25,0,0,30)
	btn.Position = UDim2.new(posX,0,0,90)
	btn.BackgroundColor3 = color
	btn.Text = name
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Parent = MainFrame
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,5)
	return btn
end

-- Rarity buttons
local MFRBtn = CreateButton("MFR", Color3.fromRGB(255,100,100), 0.05)
local NFRBtn = CreateButton("NFR", Color3.fromRGB(100,255,100), 0.375)
local FRBtn = CreateButton("FR", Color3.fromRGB(100,100,255), 0.7)
local selectedRarity = "MFR"

local function selectRarity(rarity)
	print("DEBUG: Selected rarity:", rarity)
	selectedRarity = rarity
	MFRBtn.BackgroundColor3 = (rarity=="MFR" and Color3.fromRGB(255,100,100)) or Color3.fromRGB(60,60,60)
	NFRBtn.BackgroundColor3 = (rarity=="NFR" and Color3.fromRGB(100,255,100)) or Color3.fromRGB(60,60,60)
	FRBtn.BackgroundColor3 = (rarity=="FR" and Color3.fromRGB(100,100,255)) or Color3.fromRGB(60,60,60)
end

MFRBtn.MouseButton1Click:Connect(function() selectRarity("MFR") end)
NFRBtn.MouseButton1Click:Connect(function() selectRarity("NFR") end)
FRBtn.MouseButton1Click:Connect(function() selectRarity("FR") end)

-- Spawn Button
local SpawnBtn = Instance.new("TextButton")
SpawnBtn.Size = UDim2.new(0.9,0,0,40)
SpawnBtn.Position = UDim2.new(0.05,0,0,140)
SpawnBtn.BackgroundColor3 = Color3.fromRGB(80,120,255)
SpawnBtn.Text = "Spawn Pet"
SpawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
SpawnBtn.Font = Enum.Font.SourceSansBold
SpawnBtn.TextSize = 20
SpawnBtn.Parent = MainFrame
Instance.new("UICorner", SpawnBtn).CornerRadius = UDim.new(0,5)

--// Pet spawning logic
SpawnBtn.MouseButton1Click:Connect(function()
	local petName = PetNameBox.Text
	print("DEBUG: Spawn button pressed. User typed:", petName)

	if petName == "" then
		print("DEBUG: No pet name entered.")
		return
	end

	print("DEBUG: Checking Workspace for pet:", petName)

	-- LOOK FOR PET IN WORKSPACE INSTEAD OF REPLICATEDSTORAGE
	local petTemplate = Workspace:FindFirstChild(petName)

	if petTemplate then
		print("DEBUG: PET FOUND in Workspace:", petTemplate:GetFullName())
	else
		print("DEBUG: NOT FOUND in Workspace. Checking ReplicatedStorage...")

		local rsPet = ReplicatedStorage:FindFirstChild(petName)
		if rsPet then
			print("DEBUG: FOUND PET in ReplicatedStorage:", rsPet:GetFullName())
		else
			warn("FINAL RESULT: Pet not found in ANY location:", petName)
		end

		return
	end

	local root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
	if not root then
		print("DEBUG: Root part not found.")
		return
	end

	local petClone = petTemplate:Clone()
	petClone.Parent = PetFolder

	print("DEBUG: Pet cloned and parented to:", PetFolder:GetFullName())

	if petClone.PrimaryPart then
		petClone:SetPrimaryPartCFrame(root.CFrame * CFrame.new(3, 0, 0))
		print("DEBUG: Pet moved beside player.")
	else
		print("DEBUG WARNING: Pet has NO PrimaryPart!")
	end

	table.insert(LocalInventory, {Name = petName, Rarity = selectedRarity, Model = petClone})
	print("DEBUG: Pet added to LocalInventory.")
end)

--// RunService loop: pets follow player
RunService.RenderStepped:Connect(function()
	local root = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
	if not root then return end
	for _,pet in ipairs(LocalInventory) do
		if pet.Model and pet.Model.PrimaryPart then
			local targetPos = root.Position + Vector3.new(3,0,0)
			local petPos = pet.Model.PrimaryPart.Position
			local newPos = petPos:Lerp(targetPos,0.1)
			pet.Model:SetPrimaryPartCFrame(CFrame.new(newPos))
		end
	end
end)
