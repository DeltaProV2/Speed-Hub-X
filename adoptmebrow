local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- === GUI setup (your existing code) ===
-- [Keep all your GUI creation code here as is]
-- MainFrame, Title, PetNameBox, Buttons, etc.

-- === Rarity selection logic (your existing code) ===
local selectedRarity = "MFR"
local function selectRarity(rarity)
	selectedRarity = rarity
	MFRBtn.BackgroundColor3 = (rarity == "MFR" and Color3.fromRGB(255,100,100)) or Color3.fromRGB(60,60,60)
	NFRBtn.BackgroundColor3 = (rarity == "NFR" and Color3.fromRGB(100,255,100)) or Color3.fromRGB(60,60,60)
	FRBtn.BackgroundColor3 = (rarity == "FR" and Color3.fromRGB(100,100,255)) or Color3.fromRGB(60,60,60)
end

MFRBtn.MouseButton1Click:Connect(function() selectRarity("MFR") end)
NFRBtn.MouseButton1Click:Connect(function() selectRarity("NFR") end)
FRBtn.MouseButton1Click:Connect(function() selectRarity("FR") end)

-- === Allowed pets table ===
local allowedPets = {
	["Bat Dragon"] = true,
	["Shadow Dragon"] = true,
}

-- === Function to spawn pet visually in Workspace ===
local function spawnPet(petName, rarity)
	local petTemplate = ReplicatedStorage:FindFirstChild(petName)
	if not petTemplate then
		warn("Pet template not found:", petName)
		return
	end

	local petClone = petTemplate:Clone()
	petClone.Parent = Workspace

	-- Position the pet above the player's character
	local character = Player.Character
	if character and character:FindFirstChild("HumanoidRootPart") and petClone.PrimaryPart then
		petClone:SetPrimaryPartCFrame(character.HumanoidRootPart.CFrame * CFrame.new(0, 3, 0))
	end

	-- Add BillboardGui to display name + rarity
	local billboard = Instance.new("BillboardGui")
	billboard.Adornee = petClone.PrimaryPart
	billboard.Size = UDim2.new(0, 200, 0, 50)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = true
	billboard.Parent = petClone

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.Text = petName .. " [" .. rarity .. "]"
	label.TextColor3 = Color3.fromRGB(255, 255, 0)
	label.TextScaled = true
	label.Font = Enum.Font.FredokaOne
	label.Parent = billboard

	return petClone
end

-- === Connect Spawn Button ===
SpawnBtn.MouseButton1Click:Connect(function()
	local petName = PetNameBox.Text
	if petName == "" then return end
	if not allowedPets[petName] then
		warn("Invalid pet:", petName)
		return
	end

	-- Spawn the pet visually
	spawnPet(petName, selectedRarity)

	-- Optionally, fire your server event if you want real pet
	-- PetSpawnEvent:FireServer(petName, selectedRarity)
	print("Spawned pet:", petName, "with rarity:", selectedRarity)
end)
