--// Pet Spawner LocalScript

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()
local TweenService = game:GetService("TweenService")

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PetSpawnerGui"
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

-- Create Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 180)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(255, 150, 200) -- light pink
MainFrame.BorderSizePixel = 0
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Parent = ScreenGui

-- Gradient Background
local UIGradient = Instance.new("UIGradient")
UIGradient.Color = ColorSequence.new({
	ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 180, 220)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 140, 210))
})
UIGradient.Rotation = 90
UIGradient.Parent = MainFrame

-- Neon Animated Border
local Stroke = Instance.new("UIStroke")
Stroke.Thickness = 3
Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
Stroke.Color = Color3.fromRGB(255, 0, 200)
Stroke.Parent = MainFrame

local neonColors = {
	Color3.fromRGB(255, 0, 200),   -- Pink
	Color3.fromRGB(0, 220, 255),   -- Cyan
	Color3.fromRGB(180, 0, 255),   -- Purple
	Color3.fromRGB(255, 120, 0),   -- Orange
}

task.spawn(function()
	while true do
		for _, neonColor in ipairs(neonColors) do
			local tween = TweenService:Create(
				Stroke,
				TweenInfo.new(1.5, Enum.EasingStyle.Linear),
				{ Color = neonColor }
			)
			tween:Play()
			tween.Completed:Wait()
		end
	end
end)

-- Add UICorner
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "amina pets nyo"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
-- Title Frame (darker see-through black background)
local TitleFrame = Instance.new("Frame")
TitleFrame.Size = UDim2.new(1, -20, 0, 35)
TitleFrame.Position = UDim2.new(0, 10, 0, 5)
TitleFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TitleFrame.BackgroundTransparency = 0.1 -- darker (0 = solid black, 1 = invisible)
TitleFrame.BorderSizePixel = 0
TitleFrame.Parent = MainFrame

local TitleFrameCorner = Instance.new("UICorner")
TitleFrameCorner.CornerRadius = UDim.new(0, 8)
TitleFrameCorner.Parent = TitleFrame

-- Title Text
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "amina pets nyo"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = TitleFrame

-- TextBox for Pet Name
local PetNameBox = Instance.new("TextBox")
PetNameBox.Size = UDim2.new(0.9, 0, 0, 30)
PetNameBox.Position = UDim2.new(0.05, 0, 0, 50)
PetNameBox.PlaceholderText = "Enter Pet Name"
PetNameBox.Text = ""
PetNameBox.ClearTextOnFocus = false
PetNameBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
PetNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
PetNameBox.Font = Enum.Font.SourceSans
PetNameBox.TextSize = 18
PetNameBox.Parent = MainFrame

local BoxCorner = Instance.new("UICorner")
BoxCorner.CornerRadius = UDim.new(0, 5)
BoxCorner.Parent = PetNameBox

-- Button creation helper
local function CreateButton(name, color, posY)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.25, 0, 0, 30)
	btn.Position = UDim2.new(posY, 0, 0, 90)
	btn.BackgroundColor3 = color
	btn.Text = name
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 18
	btn.Parent = MainFrame
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0,5)
	corner.Parent = btn
	return btn
end

-- Rarity Buttons
local MFRBtn = CreateButton("MFR", Color3.fromRGB(255, 100, 100), 0.05)
local NFRBtn = CreateButton("NFR", Color3.fromRGB(100, 255, 100), 0.375)
local FRBtn = CreateButton("FR", Color3.fromRGB(100, 100, 255), 0.7)

-- Spawn Pet Button
local SpawnBtn = Instance.new("TextButton")
SpawnBtn.Size = UDim2.new(0.9, 0, 0, 40)
SpawnBtn.Position = UDim2.new(0.05, 0, 0, 140)
SpawnBtn.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
SpawnBtn.Text = "Spawn Pet"
SpawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
SpawnBtn.Font = Enum.Font.SourceSansBold
SpawnBtn.TextSize = 20
SpawnBtn.Parent = MainFrame

local SpawnCorner = Instance.new("UICorner")
SpawnCorner.CornerRadius = UDim.new(0,5)
SpawnCorner.Parent = SpawnBtn

-- Movable GUI logic
-- Draggable GUI logic
-- Draggable GUI logic (drag only using the Title)
-- Draggable GUI (Title only) + Hide mouse while dragging
local UserInputService = game:GetService("UserInputService")

local dragging = false
local dragStart
local startPos
local dragInput

local function update(input)
	local delta = input.Position - dragStart
	MainFrame.Position = UDim2.new(
		0, startPos.X + delta.X,
		0, startPos.Y + delta.Y
	)
end

Title.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = Vector2.new(MainFrame.AbsolutePosition.X, MainFrame.AbsolutePosition.Y)

		-- Hide mouse
		UserInputService.MouseIconEnabled = false

		-- Stop dragging when mouse released
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
				UserInputService.MouseIconEnabled = true -- show mouse again
			end
		end)
	end
end)

Title.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input == dragInput then
		update(input)
	end
end)

-- Rarity selection logic
local selectedRarity = "MFR"

local function selectRarity(rarity)
	selectedRarity = rarity
	MFRBtn.BackgroundColor3 = (rarity == "MFR" and Color3.fromRGB(255,100,100)) or Color3.fromRGB(60,60,60)
	NFRBtn.BackgroundColor3 = (rarity == "NFR" and Color3.fromRGB(100,255,100)) or Color3.fromRGB(60,60,60)
	FRBtn.BackgroundColor3 = (rarity == "FR" and Color3.fromRGB(100,100,255)) or Color3.fromRGB(60,60,60)
end

MFRBtn.MouseButton1Click:Connect(function() selectRarity("MFR") end)
NFRBtn.MouseButton1Click:Connect(function() selectRarity("NFR") end)
FRBtn.MouseButton1Click:Connect(function() selectRarity("FR") end)

-- Spawn pet logic (replace with your own spawning code)
SpawnBtn.MouseButton1Click:Connect(function()
	local petName = PetNameBox.Text
	if petName ~= "" then
		print("Spawning pet:", petName, "with rarity:", selectedRarity)
		-- Example: fire a remote event to server to give pet
		-- game.ReplicatedStorage.SpawnPet:FireServer(petName, selectedRarity)
	end
end)

-- Pet Spawner + Adopt-Me style Backpack
-- Put this in a LocalScript under StarterPlayerScripts or inside your existing LocalScript
-- Requires a RemoteEvent at ReplicatedStorage: "EquipPet" (optional, used to notify server)

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Ensure RemoteEvent exists (optional)
local EquipPetEvent = ReplicatedStorage:FindFirstChild("EquipPet")
if not EquipPetEvent then
	EquipPetEvent = Instance.new("RemoteEvent")
	EquipPetEvent.Name = "EquipPet"
	EquipPetEvent.Parent = ReplicatedStorage
end

-- ---------- (Your existing PetSpawner GUI creation code should remain above this or be merged)
-- For brevity this script creates the Backpack GUI and expects SpawnBtn, PetNameBox, selectedRarity to exist
-- If you already have SpawnBtn and PetNameBox defined in your earlier script, comment out the below GUI creation
-- ----------

-- If your script already created ScreenGui/MainFrame/SpawnBtn/PetNameBox/selectedRarity, skip the next block.
-- (This block assumes the earlier provided GUI exists. If not, you must create or merge accordingly.)

-- Try to find your existing ScreenGui and SpawnBtn
local ScreenGui = Player:WaitForChild("PlayerGui"):FindFirstChild("PetSpawnerGui")
local MainFrame, SpawnBtn, PetNameBox

if ScreenGui then
	MainFrame = ScreenGui:FindFirstChildWhichIsA("Frame")
	SpawnBtn = ScreenGui:FindFirstChild("SpawnBtn") -- if you gave it a name earlier
	PetNameBox = ScreenGui:FindFirstChildWhichIsA("TextBox")
end

-- If SpawnBtn or MainFrame not found, create minimal ones to avoid errors (fallback)
if not ScreenGui or not MainFrame then
	ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "PetSpawnerGui"
	ScreenGui.Parent = Player:WaitForChild("PlayerGui")

	MainFrame = Instance.new("Frame")
	MainFrame.Size = UDim2.new(0, 300, 0, 180)
	MainFrame.Position = UDim2.new(0.5, -150, 0.5, -90)
	MainFrame.BackgroundColor3 = Color3.fromRGB(255, 150, 200)
	MainFrame.BorderSizePixel = 0
	MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	MainFrame.Parent = ScreenGui

	PetNameBox = Instance.new("TextBox")
	PetNameBox.Size = UDim2.new(0.9, 0, 0, 30)
	PetNameBox.Position = UDim2.new(0.05, 0, 0, 50)
	PetNameBox.PlaceholderText = "Enter Pet Name"
	PetNameBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	PetNameBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	PetNameBox.Parent = MainFrame

	SpawnBtn = Instance.new("TextButton")
	SpawnBtn.Size = UDim2.new(0.9, 0, 0, 40)
	SpawnBtn.Position = UDim2.new(0.05, 0, 0, 140)
	SpawnBtn.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
	SpawnBtn.Text = "Spawn Pet"
	SpawnBtn.TextColor3 = Color3.fromRGB(255,255,255)
	SpawnBtn.Parent = MainFrame
end

-- ---------- Backpack GUI (Adopt Me style) ----------
local BackpackGui = Instance.new("ScreenGui")
BackpackGui.Name = "PetBackpackGui"
BackpackGui.Parent = Player:WaitForChild("PlayerGui")

local BackpackFrame = Instance.new("Frame")
BackpackFrame.Name = "BackpackFrame"
BackpackFrame.Size = UDim2.new(0, 420, 0, 360)
BackpackFrame.Position = UDim2.new(0.02, 0, 0.55, 0)
BackpackFrame.AnchorPoint = Vector2.new(0, 0.5)
BackpackFrame.BackgroundTransparency = 0.05
BackpackFrame.BackgroundColor3 = Color3.fromRGB(20,20,20)
BackpackFrame.BorderSizePixel = 0
BackpackFrame.Parent = BackpackGui

local BackpackCorner = Instance.new("UICorner")
BackpackCorner.CornerRadius = UDim.new(0, 8)
BackpackCorner.Parent = BackpackFrame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, 0, 0, 36)
TitleLabel.Position = UDim2.new(0, 0, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Pets"
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 20
TitleLabel.TextColor3 = Color3.fromRGB(255,255,255)
TitleLabel.Parent = BackpackFrame

-- Scroll area for pet cards
local Scroller = Instance.new("ScrollingFrame")
Scroller.Name = "PetScroller"
Scroller.Size = UDim2.new(1, -20, 1, -56)
Scroller.Position = UDim2.new(0, 10, 0, 40)
Scroller.CanvasSize = UDim2.new(0, 0, 0, 0) -- dynamic
Scroller.ScrollBarThickness = 8
Scroller.BackgroundTransparency = 1
Scroller.Parent = BackpackFrame

local UIGrid = Instance.new("UIGridLayout")
UIGrid.CellSize = UDim2.new(0, 96, 0, 96) -- card size
UIGrid.CellPadding = UDim2.new(0, 8, 0, 8)
UIGrid.Parent = Scroller

-- Storage for pets (local cache). Each pet is a table: {id, name, rarity, favorite, equipped}
local localPets = {}
local equippedPetId = nil
local nextPetId = 0

-- Utility: create unique id
local function newPetId()
	nextPetId = nextPetId + 1
	return tostring(tick() .. "-" .. nextPetId)
end

-- Utility: add CanvasSize update
local function updateCanvasSize()
	-- wait for layout to update
	Scroller.CanvasSize = UDim2.new(0, 0, 0, UIGrid.AbsoluteContentSize.Y + 12)
end

-- Create a pet card
local function CreatePetCard(pet)
	-- pet: {id, name, rarity, favorite, equipped}
	local card = Instance.new("Frame")
	card.Name = "PetCard_" .. pet.id
	card.Size = UDim2.new(0, 96, 0, 96)
	card.BackgroundColor3 = Color3.fromRGB(28,28,28)
	card.BorderSizePixel = 0
	card.Parent = Scroller

	local cr = Instance.new("UICorner")
	cr.CornerRadius = UDim.new(0, 8)
	cr.Parent = card

	-- Pet Icon (placeholder)
	local icon = Instance.new("ImageLabel")
	icon.Name = "Icon"
	icon.Size = UDim2.new(0, 56, 0, 56)
	icon.Position = UDim2.new(0.5, -28, 0, 8)
	icon.BackgroundTransparency = 1
	icon.Image = "" -- set to a pet image asset id if available
	icon.Parent = card

	-- Pet name
	local nameLbl = Instance.new("TextLabel")
	nameLbl.Size = UDim2.new(1, -8, 0, 18)
	nameLbl.Position = UDim2.new(0, 4, 0, 64)
	nameLbl.BackgroundTransparency = 1
	nameLbl.Text = pet.name
	nameLbl.TextSize = 14
	nameLbl.Font = Enum.Font.Gotham
	nameLbl.TextColor3 = Color3.fromRGB(255,255,255)
	nameLbl.TextXAlignment = Enum.TextXAlignment.Left
	nameLbl.Parent = card

	-- Rarity Tag
	local rarityTag = Instance.new("TextLabel")
	rarityTag.Size = UDim2.new(0, 44, 0, 18)
	rarityTag.Position = UDim2.new(1, -48, 0, 6)
	rarityTag.BackgroundTransparency = 0
	rarityTag.BorderSizePixel = 0
	rarityTag.TextSize = 12
	rarityTag.Font = Enum.Font.GothamBold
	rarityTag.TextColor3 = Color3.fromRGB(255,255,255)
	rarityTag.Text = pet.rarity
	rarityTag.Parent = card

	local rtCorner = Instance.new("UICorner")
	rtCorner.CornerRadius = UDim.new(0, 6)
	rtCorner.Parent = rarityTag

	-- Favorite Star
	local favBtn = Instance.new("ImageButton")
	favBtn.Size = UDim2.new(0, 20, 0, 20)
	favBtn.Position = UDim2.new(0, 6, 0, 6)
	favBtn.BackgroundTransparency = 1
	favBtn.Image = pet.favorite and "rbxassetid://6262105480" or "rbxassetid://6262105480" -- placeholder star; you can set different image or color
	favBtn.Parent = card

	-- Equipped overlay
	local equipOverlay = Instance.new("Frame")
	equipOverlay.Size = UDim2.new(1,0,1,0)
	equipOverlay.BackgroundTransparency = pet.equipped and 0.3 or 1
	equipOverlay.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
	equipOverlay.BorderSizePixel = 0
	equipOverlay.Parent = card

	local eqLabel = Instance.new("TextLabel")
	eqLabel.Size = UDim2.new(1,0,0,18)
	eqLabel.Position = UDim2.new(0,0,1,-18)
	eqLabel.BackgroundTransparency = 1
	eqLabel.Text = pet.equipped and "Equipped" or ""
	eqLabel.Font = Enum.Font.GothamBold
	eqLabel.TextColor3 = Color3.fromRGB(0,0,0)
	eqLabel.TextSize = 12
	eqLabel.Parent = card

	-- Set rarity visuals
	local function applyRarityVisuals()
		if pet.rarity == "FR" then
			rarityTag.BackgroundColor3 = Color3.fromRGB(100, 140, 255)
			-- no neon
		elseif pet.rarity == "NFR" then
			rarityTag.BackgroundColor3 = Color3.fromRGB(255, 120, 40)
			-- single neon: add a UIStroke that stays one color
			local stroke = Instance.new("UIStroke")
			stroke.Thickness = 2
			stroke.Parent = card
			stroke.Color = Color3.fromRGB(0, 255, 200) -- example neon color
		elseif pet.rarity == "MFR" then
			rarityTag.BackgroundColor3 = Color3.fromRGB(200, 80, 255)
			-- mega neon: rainbow stroke
			local stroke = Instance.new("UIStroke")
			stroke.Thickness = 2
			stroke.Parent = card
			-- Animated rainbow
			local colors = {
				Color3.fromRGB(255,0,0),
				Color3.fromRGB(255,127,0),
				Color3.fromRGB(255,255,0),
				Color3.fromRGB(0,255,0),
				Color3.fromRGB(0,127,255),
				Color3.fromRGB(139,0,255)
			}
			task.spawn(function()
				local idx = 1
				while stroke.Parent do
					local nextIdx = idx % #colors + 1
					local tween = TweenService:Create(stroke, TweenInfo.new(0.8, Enum.EasingStyle.Linear), {Color = colors[nextIdx]})
					tween:Play()
					tween.Completed:Wait()
					idx = idx + 1
				end
			end)
		else
			rarityTag.BackgroundColor3 = Color3.fromRGB(80,80,80)
		end
	end

	applyRarityVisuals()

	-- Favorite toggle
	favBtn.MouseButton1Click:Connect(function()
		pet.favorite = not pet.favorite
		-- Quick visual: scale star
		local scale = Instance.new("UIScale")
		scale.Parent = favBtn
		scale.Scale = 1.4
		game:GetService("TweenService"):Create(scale, TweenInfo.new(0.18), {Scale = 1}):Play()
		-- You can change the image/colour to reflect favorite state
		if pet.favorite then
			favBtn.ImageTransparency = 0
		else
			favBtn.ImageTransparency = 0.6
		end
		-- Optionally move favorites on top (simple approach: update sort)
		table.sort(localPets, function(a,b)
			if a.favorite == b.favorite then
				return a.name:lower() < b.name:lower()
			else
				return a.favorite and not b.favorite
			end
		end)
		-- Rebuild UI
		for _, child in ipairs(Scroller:GetChildren()) do
			if child:IsA("Frame") then child:Destroy() end
		end
		for _, p in ipairs(localPets) do
			CreatePetCard(p)
		end
		updateCanvasSize()
	end)

	-- Equip on click
	card.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			-- Equip this pet
			for _, p in ipairs(localPets) do
				p.equipped = (p.id == pet.id)
			end
			equippedPetId = pet.id
			-- Visual update: rebuild cards quickly (simple)
			for _, child in ipairs(Scroller:GetChildren()) do
				if child:IsA("Frame") then child:Destroy() end
			end
			for _, p in ipairs(localPets) do
				CreatePetCard(p)
			end
			updateCanvasSize()

			-- Notify server to spawn/equip pet (server must implement EquipPet RemoteEvent)
			-- Send pet data: name, rarity, id
			EquipPetEvent:FireServer({name = pet.name, rarity = pet.rarity, id = pet.id})
			print("Equipped pet:", pet.name, pet.rarity)
		end
	end)

	-- set initial visual state for favorite & equipped
	if pet.favorite then favBtn.ImageTransparency = 0 else favBtn.ImageTransparency = 0.6 end
	if pet.equipped then
		equipOverlay.BackgroundTransparency = 0.3
		eqLabel.Text = "Equipped"
	else
		equipOverlay.BackgroundTransparency = 1
		eqLabel.Text = ""
	end

	return card
end

-- Add pet to local inventory and UI
local function AddPetToBackpack(petName, rarity)
	local id = newPetId()
	local pet = {
		id = id,
		name = petName,
		rarity = rarity or "FR",
		favorite = false,
		equipped = false
	}
	table.insert(localPets, pet)

	-- Basic sort: favorites first then name
	table.sort(localPets, function(a,b)
		if a.favorite == b.favorite then
			return a.name:lower() < b.name:lower()
		else
			return a.favorite and not b.favorite
		end
	end)

	-- Create card
	CreatePetCard(pet)
	updateCanvasSize()
end

-- Hook the SpawnBtn to add pet to backpack when pressed
if SpawnBtn then
	SpawnBtn.MouseButton1Click:Connect(function()
		local petName = PetNameBox and PetNameBox.Text or "Pet"
		petName = petName ~= "" and petName or "Pet"
		if petName then
			-- Use selectedRarity from your earlier code if present, otherwise default "FR"
			local rarity = _G and _G.selectedRarity or (selectedRarity or "FR")
			-- If your earlier script used variable 'selectedRarity', it will be read here.
			AddPetToBackpack(petName, rarity)
			print("Added to backpack:", petName, rarity)
		end
	end)
end

-- Example: add a few sample pets on join (optional, for testing)
AddPetToBackpack("Bat Dragon", "MFR")
AddPetToBackpack("Shadow Cat", "NFR")
AddPetToBackpack("Panda", "FR")

-- Final: make Backpack draggable (small touch)
local dragging, dragInput, dragStart, startPos = false, nil, nil, nil
local UserInputService = game:GetService("UserInputService")

BackpackFrame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = Vector2.new(BackpackFrame.AbsolutePosition.X, BackpackFrame.AbsolutePosition.Y)
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

BackpackFrame.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input == dragInput then
		local delta = input.Position - dragStart
		BackpackFrame.Position = UDim2.new(0, startPos.X + delta.X, 0, startPos.Y + delta.Y)
	end
end)

-- Call updateCanvasSize initially (UIGrid might need a tick)
task.defer(updateCanvasSize)
